<link rel ="stylesheet" href= "style.css" type="text/css">


<script src="fetch.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    async function meter() {
        var sensor_id = document.getElementById('gasInput').value
        //var dis = document.getElementById('display')

        try {
            let data = await getDataForSensorId(sensor_id)
            //dis.innerHTML = JSON.stringify(data, null, '\t')

            //plotting

            var first48 = getSelectReadings(data, 50);
            //console.log(JSON.stringify(first48));
            

            //this toggles the visibility of the text overview when fucntion fires
            var overview = document.getElementById('overview');
            overview.style.display = "inline";

            //calculates data to compare 

           var dustHood = await getDataForNeighborhood(sensor_id);
          console.log("#&#&#&#&hood next:");
           console.dir(dustHood);

        entireHood = wholeNeighborhood(dustHood);
        //console.log("the HWHIE HOOD NEXST");
       // console.dir(entireHood);

 console.log("the 2ns from hood");
         console.log(entireHood[3].time);
  console.log(entireHood[3].reading);

        plotTime(first48);
            neighborhoodPlot(entireHood);

        }
        catch (err) {
            console.log(err)
        }
    }

function getSelectReadings (data, numReadings){
//
    let selectTime = [];
   let selectReadings = [];
   let selectObj = {};
   
   //grab most recent numReadings readings (* 2 for hours)
   const selectData =  data.readings.slice(0,numReadings);
    selectData.forEach (function(val) {
        selectTime.push(val[0]);
        selectReadings.push(val[1]);
      
    })

    //create object
  selectObj.time = selectTime;
   selectObj.reading =  selectReadings;
    //console.log("the object"+JSON.stringify(selectObj));
    return selectObj;
 
}

function compareNeighbors(sensor_id) {


}


function calculateCost (sensor_id) {

    //$0.13361 per hundred cubic feet (Ccf) 
}

//take neighborhood data convert for the plotting. 
function wholeNeighborhood (hood){
//
    let neighborTime = [];
   let neighborReading = [];
   let neighborObj = {};
   let aggregatedneighborArray= [];
   
   //grab most recent numReadings readings (* 2 for hours)

    hood.forEach(
            function(val) {
                val.readings.forEach(
                    function(num){
                        neighborTime.push(num[0]);
                        neighborReading.push(num[1]);

                })
            neighborObj.time = neighborTime;
            neighborObj.reading = neighborReading;
            neighborReading = [];
            neighborTime = [];
        {

    aggregatedneighborArray.push(neighborObj);
         neighborObj = {}; 
        }
        
    })


    //console.log("the object"+JSON.stringify(selectObj));
    return aggregatedneighborArray;
 
}


// plotting function in which an object is passed of time series and readings


function plotTime (timeSeries) {
    
var timesTrace = {
  x: timeSeries.time, 
  y: timeSeries.reading,
  mode: 'lines'
};

var timeTraceData = [timesTrace];

var timeLayout = {
  title:'Your gas usage over past day',
  font: {
    family: 'Open Sans',
    color: '#000000',
    size: 18
  }
};

Plotly.newPlot('timeSeries', timeTraceData, timeLayout);


}


///Neighborhood large plot

function neighborhoodPlot(hoodSet) {
    

//for (i=0;i<hoodSet.length;i++) {
//ar hoodTrace = hoodSet[i][0];



var hoodTrace1 = {
  x: hoodSet[0].time, 
  y: hoodSet[0].reading,
  mode: 'lines'
};

var hoodTrace2 = {
  x: hoodSet[1].time, 
  y: hoodSet[1].reading,
  mode: 'lines'
};

var hoodTrace3 = {
  x: hoodSet[2].time, 
  y: hoodSet[2].reading,
  mode: 'lines'
};

var hoodTrace4 = {
  x: hoodSet[3].time, 
  y: hoodSet[3].reading,
  mode: 'lines'
};

var hoodTrace5 = {
  x: hoodSet[4].time, 
  y: hoodSet[4].reading,
  mode: 'lines'
};

var hoodTrace6 = {
  x: hoodSet[5].time, 
  y: hoodSet[5].reading,
  mode: 'lines'
};




var hoodData = [hoodTrace1, hoodTrace2, hoodTrace3, hoodTrace4, hoodTrace5, hoodTrace6];

var hoodLayout = {
  title:'Gas Usage Among Your Neighbors',
  font: {
    family: "Open-Sans",
    color: '#000000',
    size: 18
  }
};

Plotly.newPlot('neighborhoodTime', hoodData, hoodLayout);


}






</script>

<div id="main">
<h1>
  <img src="flame.png">  Enter your gas meter ID number to see how you match up with your neighbors:
</h1>


<input id="gasInput" type="text" value="20383530">
<button onclick="meter()">Go</button>

<pre id="display"></pre>

<p id="overview">Your gas usage is <span id="highlight">"usageReleative"</span> average for your neighborhood. <br />You can close your shades, lower your thermostat, or let in bright sun. <br />
<br />


Today, you're using enough gas to cost you ___ on a monthly basis. </p>

<div id= "timeSeries"></div>
<div id= "neighborhoodTime"></div>

</div>
